# APLAutoHotKey
Application to generate AutoHotKey scripts to enable APL glyph keyboard input

## Usage
APLAutoHotKey is available as an executable (.exe), Dyalog workspace (.dws) for version 18.2 or later and the source is a [Cider](https://github.com/aplteam/Cider) project.

### GUI

#### Executable
Download the latest release zip from the [Releases page](https://github.com/rikedyp/APLAutoHotKey/releases), unzip it and double click on **APLAutoHotKey.exe**.

#### Workspace
`)LOAD` or double-click on the workspace file to launch the GUI application.

### API
The following demonstrates how to use the API to generate scripts programmatically.

1. Import APLAutoHotKey:

  ```
   ]Get -u https://github.com/rikedyp/APLAutoHotKey/releases/download/v0.1.0/APLAutoHotKey.dws
  ```

> `]Get` can accept a local file path or the URL of a released .dws workspace

2. Set options

  ```
   opt←⎕NS⍬
   opt.shifts←'CapsLock' 'RAlt'
   opt.locale←'en_GB'
   opt.outpath←'/tmp/APL-en_GB-CapsLockAlt.ahk'
  ```
  
3. Generate and save the script

  ```
         APLAutoHotKey.MakeScript opt
   ┌─┬──────────────────────────────────────────────────┐
   │0│Saved: /tmp/APL-en_GB-CapsLockAlt.ahk (9404 bytes)│
   └─┴──────────────────────────────────────────────────┘
  ```
  
## TODO
- [x] Enumerate options
- [ ] Test individual options
- [ ] Test combinations of options
- [ ] Suspend key combination + suspend when Classic window active
- [ ] Option to disable caps lock behaviour
- [ ] Option to save script to user startup folder
- [ ] More useful reporting of FILE errors

## Options

### Layouts
Each script is based on a single locale. 

|locale|code|
|---|---|
|English (UK)|en_GB|
|English(US)|en_US|
|Danish|da_DK|
|German (Germnay)|de_DE|
|Spanish (Spain)|es_ES|
|French (France)|fr_FR|

- [x] en_GB
- [x] en_US
- [x] da_DK
- [x] de_DE
- [x] es_ES
- [x] fr_FR
- [x] it_IT
- [x] fi_FI
- [x] sv_SE

> Other layouts can be supported on request, or generated by the user if they create the appropriate key map

- [ ] Check IME matches https://dfns.dyalog.com/n_keyboards.htm (⍺ ⍵ French)

### Shifting key
This is a key which, while pressed, enables the input of APL glyphs. For example, <kbd>Ctrl + e</kbd> produces `∊`.

- [x] CapsLock
- [x] Left Control
- [x] Right Control
- [x] Control (both)
- [x] Left Alt
- [x] Right Alt
- [x] Alt (both)
- [ ] LWin
- [ ] RWin
- [ ] Win (both)
- [ ] AltGr
- [ ] Can translate JS key code into AHK SC scan code?

> AltGr sends a LCtrl+LAlt signal. AltGr and LAlt can get different behaviours by mapping `<^>!::RAlt` and using `LAlt` and `RAlt`. If both Left Alt and Right Alt are selected, then a single `Alt` hotkey is used, but if only Left Alt is selected, then `AltGr` must be remapped to `RAlt`. TODO: does this affect e.g. accents or special characters via AltGr on regular Windows keyboard?
> Use of `LCtrl`, `Ctrl`, `RAlt` or `Alt` can interfere with `AltGr` behaviour

### Suspend
The user may specify a key combination to toggle suspension of hotkeys, which may be useful if an application uses keyboard shortcuts with which the hotkeys interfere.

#### Dyalog Classic Edition
If a Control (<kbd>Ctrl</kbd>) key is used as the APL shifting key, Dyalog Classic interpreters fail to register keyboard input for APL glyphs while the hotkeys are active. This is avoided by suspending AutoHotKey while Dyalog Classic interpreter windows are active.

The build script checks the Microsoft Windows registry for installations of Dyalog Classic interpreters, and adds the paths to their executable files to the "Classic" group. When a Classic window is active, hotkeys suspend to allow classic.

If a user installs a Dyalog Classic interpreter, then they can either rebuild their script using APLAutoHotKey, or add the path to the executable file in an additional `GroupAdd` line in their script.

## Development
This application is developed as a [Cider](https://github.com/aplteam/Cider) project.

Open the project:

```
]CIDER.OpenProject /path/to/APLAutoHotKey
```

Build a new release executable and workspace:

```
]CIDER.Make
```

### Mapping dead keys
Some keys do not immediately produce output when pressed, but will affect the next key press usually by adding an accent to a letter. These are known as "dead keys".

In AutoHotKey **.ahk** scripts, you may use a Unicode character directly to indicate it as a HotKey meaning that some action is taken when that character is output by the keyboard. For dead keys, you should use the *scan code* corresponding to that key.

To find the scan code for a particular key, start AutoHotKey by double-clicking any script file. A green "H" icon will appear in the system tray. **Right click** the system tray icon → click **Open** → click the **View** menu item and then click **Key history and script info**. Press the key and then press F5. The 2nd most recent key in the list should be the key you just pressed, and the 3-digit alphanumeric code in the 2nd column is the scan code.
